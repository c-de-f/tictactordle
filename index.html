<!DOCTYPE>
<html>
    <head>
        <style>
    .button.built {
        top: 0%; 
        position: fixed;
        border-radius: 10px;
        width: 100px;
        height: 100px;
        z-index: 2;
    }
    .button.built:disabled,button:disabled,
button[disabled] {
        color: #000000;
    }
    .cellcnt
    {
     position: fixed;
        width: 100px;
        height: 100px;   
        
    }
    .letter
    {
        position: relative;
        width: 20px;
        height: 20px;
        top:0;
        left:0;
        z-index:50;
        font-size:20px;
        text-align: center;
    }

    .guesser
    {
        position: relative;
        width: 20px;
        height: 20px;
        top:0;
        left:0;
        z-index:50;
        font-size:20px;
        text-align: center;
        margin:auto;
    }
    .xo
    {
        position: relative;
        width: 20px;
        height: 20px;
        bottom:0;
        left:80;
        z-index:50;
        font-size:20px;
        text-align: center;
    }

    input[type="text"]
    {
        top: 40px; 
        left:40px;
        position: relative;
        width: 20px;
        z-index: 20;
    }
    </style>
    </head>
    <body onload="printBtn();"></body>
    <script>
            let letters_alphabet='abcdefghijklmnopqrstuvwxyz'.split('');
            let init_wordlist=['abash','tithe','epoxy','ounce','vegan','budge','lanky','peril','swift','block'];
            let field = Array(5).fill().map(() => Array(5).fill(0));
            let word='';
            let letters_tried = [];
            let letters_field = Array(5).fill().map(() => Array(5).fill(null));

                function disableField()
                {
                    for (var i = 0; i < 5; i++) {
                        for (var j = 0; j < 5; j++) {
                    document.getElementById(i+'_'+j).disabled = true;
                        }
                    }
                }

                function getEmojis(res)
                {
                    var d= document.createElement("div");
                    var p= document.createElement("p");
                    x='';
                    for (var i = 0; i < 5; i++) {
                         for (var j = 0; j < 5; j++) {
                            if (field[i][j] ==0) x+=' ';
                            if (field[i][j] ==1) x+='x';
                            if (field[i][j] ==1) x+='0';
                    }
                    x+='\n';
                    }
                    x+='res';
                    var tn = document.createTextNode('Your results to copy are:\n'+x);
                    p.appendChild(tn);

                    d.appendChild(p);
                    document.body.appendChild(d);
                }

                function putGuesser()
                {
                    for (var j = 0; j < 5; j++) {
                           var d= document.createElement("div");
                           d.id='cnt'+i+'_'+j;
                           var btn = document.createElement("button");
                           //btn.setAttribute("value",i+'_'+j);
                           btn.className = btn.className + "button built";
                           btn.id=i+'_'+j;
                           
                           d.className = d.className + "cellcnt";
                           d.style.left=btn.style.left=100+j*100;
                           d.style.top=btn.style.top=500;
                           //btn.textContent=btn.id;
                           btn.onclick = function() {setState(this.id);};
                           d.appendChild(btn);
                           document.body.appendChild(d);
                        }
                }

                function checkWordle()
                {
                    res='';
                    for (var j = 0; j < 5; j++) {
                        if (!letters_field[5][j]) return;
                    }
                    check_word='';
                    for (var j = 0; j < 5; j++) {
                        check_letter=letters_field[5][j];
                        check_word+=check_letter;
                        if (check_letter == word[j])
                        {
                            document.getElementById(5+'_'+j).style.backgroundColor = "#6aaa64";
                            res+='+';
                        }
                        else if (word.includes(check_letter))
                        {
                            document.getElementById(5+'_'+j).style.backgroundColor = "#c9b458";
                            res+='0';
                        }
                        else
                        {
                            document.getElementById(5+'_'+j).style.backgroundColor = "#787c7e";
                            res+='-';
                        }


                    }
                    if (check_word == word)
                    {
                        alert('You won!');
                    }
                    else
                    {
                        alert('Oops, word was '+word);
                    }
                    getEmojis(res);

                }

                function putLetter(letter, sign, _id)
                {
                    _lett=document.createElement("p");
                    _lett.className = _lett.className + "letter";
                    var tn = document.createTextNode(letter);
                    _lett.appendChild(tn);
                    document.getElementById('cnt'+_id).appendChild(_lett);

                    _sym=document.createElement("p");
                    _sym.className = _sym.className + "xo";
                    tn = document.createTextNode(sign.toUpperCase());
                    _sym.appendChild(tn);
                    document.getElementById('cnt'+_id).appendChild(_sym);
                    return;
                }

                function isWin()
                {
                    let lines=Array(12).fill('');
                    for (var i = 0; i < 5; i++) {
                        for (var j = 0; j < 5; j++) {
                            lines[j]+=''+field[i][j]; //rows
                            lines[5+i]+=''+field[i][j]; //cols
                        }
                        lines[10]+=''+field[i][i];
                        lines[11]+=''+field[i][4-i];
                    }
                    for (var i = 0; i < lines.length; i++) {console.log(lines[i])}
                    if (lines.indexOf('11111') != -1) {return 'x'};
                    if (lines.indexOf('-1-1-1-1-1') != -1) {return 'o'};
                    const sort = str => str.split('').sort((a, b) => a.localeCompare(b)).join('');
                    for (var i = 0; i < lines.length; i++) {if (sort(lines[i]) == '01111') return 'i';}
                    return null;
                }

                function setWord()
                {
                    var curdate = new Date();
                    var refdate = new Date(2022, 5, 7);
                    diff = (new Date(curdate.getTime() - refdate.getTime())).getUTCDate() - 1;
                    console.log ('Word number is: '+diff);
                    word=init_wordlist[diff];
                    console.log ('Word is: '+word);
                }

              
                //the array
                function printBtn() {
                    setWord();
                    for (var i = 0; i < 5; i++) {
                        for (var j = 0; j < 5; j++) {
                           var d= document.createElement("div");
                           d.id='cnt'+i+'_'+j;
                           var btn = document.createElement("button");
                           //btn.setAttribute("value",i+'_'+j);
                           btn.className = btn.className + "button built";
                           btn.id=i+'_'+j;
                           
                           d.className = d.className + "cellcnt";
                           d.style.left=btn.style.left=100+j*100;
                           d.style.top=btn.style.top=i*100;
                           //btn.textContent=btn.id;
                           btn.onclick = function() {setState(this.id);};
                           d.appendChild(btn);
                           document.body.appendChild(d);
                        }
                    }
                }

                function validate(input, _id){
                    
       // alert(input.value);

       let l=input.value[0];
    letters_tried.push(l);
    [i,j]= _id.split('_');

    letters_field[i,j]=l;
    document.getElementById('inp'+i+'_'+j).type="hidden";
    if (i>4)
    {
        _lett=document.createElement("p");
                    _lett.className = _lett.className + "guesser";
                    var tn = document.createTextNode(letter);
                    _lett.appendChild(tn);
                    document.getElementById('cnt'+_id).appendChild(_lett);
                    checkWordle();
        
        return;
    }
    //document.getElementById(i+'_'+j).textContent=l.toUpperCase()+'/x';
    putLetter(l.toUpperCase(), 'x', _id);
              console.log("field is:"+field);
             cpuStep(_id);
    console.log("letters are:"+letters_field);
    document.getElementById(_id).disabled = true;
}

function getLetter(not_in_word)
{
    untried = letters_alphabet.filter(x => !letters_tried.includes(x) );
    if (not_in_word)
    {
        untried = untried.filter(x => !word.includes(x) );
    }
    return untried[Math.floor(Math.random()*untried.length)];
}


function cpuStep(_id){
[i,j]= _id.split('_');
l=letters_field[i,j];
ind=word.indexOf(l);
let x_ind=-1;
let y_ind=-1;
x=isWin();

if ((ind == j) || (word[j] == l))
{
    document.getElementById(i+'_'+j).style.backgroundColor = "#6aaa64";
    put_l=getLetter(1);
    x_ind=(i+1)%5;
    y_ind=j;
    while (field[x_ind][y_ind] !=0)
    {
        x_ind=Math.floor(Math.random()*5);
        y_ind=Math.floor(Math.random()*5);
    }
    field[x_ind][y_ind]=-1;
    letters_field[x_ind][y_ind]=put_l;
    letters_tried.push(put_l);
    setTimeout(function(){ 

       
//document.getElementById(x_ind+'_'+y_ind).textContent=put_l.toUpperCase()+'/o';
putLetter(put_l.toUpperCase(), 'o', x_ind+'_'+y_ind);
    document.getElementById(x_ind+'_'+y_ind).style.backgroundColor = "#787c7e"; 
    }, 500);  
    console.log("set lower letter to gray");
}
else if (ind != -1)
{
    document.getElementById(i+'_'+j).style.backgroundColor = "#c9b458";
    console.log("set lower letter to whatever");
    put_l=getLetter(0);
    x_ind=(i+1)%5;
    y_ind=j;
    while (field[x_ind][y_ind] !=0)
    {
        x_ind=Math.floor(Math.random()*5);
        y_ind=Math.floor(Math.random()*5);
    }
    field[x_ind][y_ind]=-1;
    letters_field[x_ind][y_ind]=put_l;
    letters_tried.push(put_l);
    setTimeout(function(){ 

       

    //document.getElementById(x_ind+'_'+y_ind).textContent=put_l.toUpperCase()+'/o';
    putLetter(put_l.toUpperCase(), 'o', x_ind+'_'+y_ind);
    document.getElementById(x_ind+'_'+y_ind).style.backgroundImage="linear-gradient(45deg, #c9b458 25%, #787c7e 25%, #787c7e 50%, #c9b458 50%, #c9b458 75%, #787c7e 75%, #787c7e 100%)";

    }, 500);  
}
else
{
    document.getElementById(i+'_'+j).style.backgroundColor = "#787c7e";
    let put_l=getLetter(0);
    x_ind=Math.floor(Math.random()*5);
    y_ind=Math.floor(Math.random()*5);
    while (field[x_ind][y_ind] !=0)
    {
        x_ind=Math.floor(Math.random()*5);
        y_ind=Math.floor(Math.random()*5);
    }
    field[x_ind][y_ind]=-1;
    letters_field[x_ind][y_ind]=put_l;
    letters_tried.push(put_l);
    setTimeout(function(){ 

         

    //document.getElementById(x_ind+'_'+y_ind).textContent=put_l.toUpperCase()+'/o';
    putLetter(put_l.toUpperCase(), 'o', x_ind+'_'+y_ind);
    document.getElementById(x_ind+'_'+y_ind).style.backgroundImage="linear-gradient(45deg, #c9b458 25%, #787c7e 25%, #787c7e 50%, #c9b458 50%, #c9b458 75%, #787c7e 75%, #787c7e 100%)";
    }, 500); 
    console.log("set whatever letter to whatever");
}
document.getElementById(x_ind+'_'+y_ind).disabled = true;
x=isWin();
if (x == 'o')
{
    disableField();
    alert('You lost, refresh page to play again');
    console.log('You lost, try again');
    //you lost, try again
}
if (x == 'x')
{
    disableField();
    alert('You won xo, guess a wordle now');
    putGuesser();
    console.log('You won xo, guess a wordle now');
    //you lost, try again
}
}
                function setState(_id)
            {
                var _in = document.createElement('input');
                _in.id='inp'+_id;
                _in.type="text";
                _in.maxLength="1";
                _in.onkeyup = function() {validate(this, _id);};
                _in.size="1";

                document.getElementById('cnt'+_id).appendChild(_in);
              [i,j]= _id.split('_');
              
              field[i][j]=1;

              
            }


              
           
    </script>
</html>